<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speech to Text</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .mic-toggle {
            display: none;
        }
        .mic-icon {
            font-size: 24px;
            cursor: pointer;
            color: #333;
        }
        .mic-toggle:checked + .mic-icon {
            color: #007bff;
        }
    </style>
</head>
<body>
    <h1>Speech to Text en Español</h1>
    <label>
        <input type="checkbox" id="listenCheckbox" class="mic-toggle">
        <i class="fas fa-microphone mic-icon"></i>
    </label>
    <br><br>
    <input type="text" id="textInput" placeholder="El texto reconocido aparecerá aquí" style="width: 300px;">

    <script>
        const checkbox = document.getElementById('listenCheckbox');
        const textInput = document.getElementById('textInput');
        let recognition;

        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'es-ES';

            recognition.onresult = function(event) {
                let interimTranscript = '';
                let finalTranscript = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    let transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript;
                        console.log(transcript);  // Imprime en la consola del navegador
                        fetch('/log', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({text: transcript}),
                        });
                    } else {
                        interimTranscript += transcript;
                    }
                }
                textInput.value = finalTranscript || interimTranscript;
            };

            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    recognition.start();
                    textInput.value = '';  // Limpiar el input al comenzar
                } else {
                    recognition.stop();
                }
            });
        } else {
            alert('Tu navegador no soporta reconocimiento de voz.');
        }
    </script>
</body>
</html>